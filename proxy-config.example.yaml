# Example configuration for the standalone ethpandaops proxy
# This proxy runs in Kubernetes and handles credential injection for MCP clients.

server:
  # Address to listen on
  listen_addr: ":18081"

  # HTTP timeouts
  read_timeout: 30s
  write_timeout: 5m
  idle_timeout: 60s

auth:
  # Authentication mode: "jwt" for remote JWT validation, "token" for local tokens
  mode: jwt

  jwt:
    # JWKS URL for JWT validation (e.g., from Dex)
    jwks_url: "${DEX_JWKS_URL}"

    # Expected token issuer
    issuer: "${DEX_ISSUER_URL}"

    # Expected token audience (optional)
    audience: "ethpandaops-proxy"

    # Allowed GitHub organizations
    # Users must be members of at least one of these orgs
    allowed_orgs:
      - ethpandaops
      - sigp

    # How often to refresh the JWKS cache
    refresh_interval: 1h

# ClickHouse clusters
clickhouse:
  - name: xatu
    host: "${CLICKHOUSE_HOST}"
    port: 8443
    database: default
    username: "${CLICKHOUSE_USERNAME}"
    password: "${CLICKHOUSE_PASSWORD}"
    secure: true
    skip_verify: false
    timeout: 300

# Prometheus instances
prometheus:
  - name: primary
    url: "${PROMETHEUS_URL}"
    username: "${PROMETHEUS_USERNAME}"
    password: "${PROMETHEUS_PASSWORD}"

# Loki instances
loki:
  - name: primary
    url: "${LOKI_URL}"
    username: "${LOKI_USERNAME}"
    password: "${LOKI_PASSWORD}"

# S3 storage for file uploads
s3:
  endpoint: "${S3_ENDPOINT}"
  access_key: "${S3_ACCESS_KEY}"
  secret_key: "${S3_SECRET_KEY}"
  bucket: "ethpandaops-mcp-outputs"
  region: "us-east-1"
  public_url_prefix: "${S3_PUBLIC_URL_PREFIX}"

# Rate limiting
rate_limiting:
  enabled: true
  requests_per_minute: 60
  burst_size: 10

# Audit logging
audit:
  enabled: true
  log_queries: true
  max_query_length: 500
