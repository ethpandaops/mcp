// Package observability provides metrics capabilities for ethpandaops-mcp.
package observability

import (
	"github.com/prometheus/client_golang/prometheus"
)

// Metrics namespace for all ethpandaops-mcp metrics.
const metricsNamespace = "ethpandaops_mcp"

// Tool call metrics.
var (
	// ToolCallsTotal counts the total number of tool calls by tool name and status.
	ToolCallsTotal = prometheus.NewCounterVec(
		prometheus.CounterOpts{
			Namespace: metricsNamespace,
			Name:      "tool_calls_total",
			Help:      "Total number of tool calls",
		},
		[]string{"tool", "status"},
	)

	// ToolCallDuration measures the duration of tool calls in seconds.
	ToolCallDuration = prometheus.NewHistogramVec(
		prometheus.HistogramOpts{
			Namespace: metricsNamespace,
			Name:      "tool_call_duration_seconds",
			Help:      "Duration of tool calls in seconds",
			Buckets:   prometheus.ExponentialBuckets(0.1, 2, 10),
		},
		[]string{"tool"},
	)
)

// Connection metrics.
var (
	// ActiveConnections tracks the number of active MCP connections.
	ActiveConnections = prometheus.NewGauge(
		prometheus.GaugeOpts{
			Namespace: metricsNamespace,
			Name:      "active_connections",
			Help:      "Number of active MCP connections",
		},
	)
)

func init() {
	// Register all metrics with the default registry.
	prometheus.MustRegister(
		ToolCallsTotal,
		ToolCallDuration,
		ActiveConnections,
	)
}
