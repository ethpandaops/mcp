# Xatu MCP Server Configuration
# Copy this file to config.yaml and customize for your environment.
# Environment variables can be substituted using ${VAR_NAME} syntax.

server:
  host: "0.0.0.0"
  port: 8080
  base_url: "http://localhost:8080"

# Grafana configuration
# All data queries (ClickHouse, Prometheus, Loki) are proxied through Grafana.
# This simplifies credential management - you only need a single Grafana service token.
grafana:
  url: "${GRAFANA_URL}"  # e.g., https://grafana.ethpandaops.io
  service_token: "${GRAFANA_SERVICE_TOKEN}"  # Service account token with datasource:read and datasource:query permissions
  timeout: 120  # seconds

  # Datasources configuration with descriptions for LLM context
  # If specified, only these datasources are exposed
  # Each datasource can have a description that provides context for the LLM
  datasources:
    - uid: "your-clickhouse-uid"
      description: |
        ClickHouse database containing Xatu data.
        Always filter by partition key to avoid full table scans.
        Use CTEs for distributed queries. Avoid global joins.

    - uid: "your-loki-uid"
      description: |
        Loki cluster for container logs.
        Must filter by label (e.g., ingress_user, container, pod, namespace).

    - uid: "your-prometheus-uid"
      description: |
        Prometheus/VictoriaMetrics for metrics.
        Common labels: ingress_user, container, pod, namespace.

# Sandbox configuration
sandbox:
  # Backend: docker (local dev) | gvisor (production)
  backend: docker
  image: "xatu-mcp-sandbox:latest"
  timeout: 60  # seconds
  memory_limit: "2g"
  cpu_limit: 1.0
  network: "mcp-internal"

  # Session configuration (optional)
  # When enabled, sandbox containers persist between calls
  # session:
  #   enabled: true
  #   ttl: 10m        # idle timeout
  #   max_duration: 1h  # absolute max session lifetime
  #   max_sessions: 10  # max concurrent sessions

# S3-compatible storage for output files
storage:
  endpoint: "${S3_ENDPOINT}"  # e.g., http://minio:9000 or https://xxx.r2.cloudflarestorage.com
  access_key: "${S3_ACCESS_KEY}"
  secret_key: "${S3_SECRET_KEY}"
  bucket: "xatu-mcp-outputs"
  region: "us-east-1"
  public_url_prefix: "${S3_PUBLIC_URL}"  # e.g., https://outputs.example.com

# Authentication configuration
# When enabled, requires GitHub OAuth for HTTP transports (SSE, streamable-http).
# Stdio transport (local/Claude Desktop) never requires auth.
auth:
  enabled: false  # Set to true to require authentication

  # GitHub OAuth configuration (required when auth.enabled is true)
  # github:
  #   client_id: "${GITHUB_CLIENT_ID}"
  #   client_secret: "${GITHUB_CLIENT_SECRET}"

  # Organizations allowed to access the server (empty = all authenticated users)
  # allowed_orgs:
  #   - "ethpandaops"

  # JWT token configuration
  # tokens:
  #   secret_key: "${JWT_SECRET_KEY}"  # Required when auth is enabled

# Observability configuration
observability:
  metrics_enabled: true
  metrics_port: 9090

  tracing_enabled: false
  # otlp_endpoint: "${OTLP_ENDPOINT}"

# ClickHouse schema discovery configuration
# Discovers table schemas from configured ClickHouse datasources via Grafana.
# Each datasource must be explicitly configured with its Grafana UID and cluster name.
schema_discovery:
  # enabled: true  # Defaults to true if datasources are configured
  refresh_interval: 15m  # How often to refresh schema cache

  # Datasources to discover schemas from
  # Each entry maps a Grafana datasource UID to a logical cluster name
  datasources:
    - uid: "your-clickhouse-datasource-uid"
      cluster: "xatu"
    - uid: "your-clickhouse-cbt-datasource-uid"
      cluster: "xatu-cbt"
